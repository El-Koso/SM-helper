# Документация к коду приложения для ввода и обработки данных

Этот код представляет собой приложение на Python с графическим интерфейсом (GUI) на основе Tkinter, предназначенное для генерации XML- файла с данными о сотрудниках организации, прошедших обучение и аттестацию по определенным программам подготовки в области охраны труда. Приложение также позволяет сохранять информацию о протоколах.

## I. Структура приложения:

Приложение состоит из нескольких модулей (хотя в представленном коде они объединены в одном файле):

* **GUI (графический интерфейс):** Создает и управляет всеми элементами интерфейса: полями ввода, кнопками, списком учебных программ и таблицей протоколов.
* **Валидация данных:** Проверяет корректность введенных данных (формат СНИЛС, дата).
* **Взаимодействие с базой данных:** Отвечает за создание базы данных, добавление, удаление и обновление записей, а также за выборку данных для отображения и генерации XML.
* **Генерация XML:** Формирует XML-файл с данными из базы данных, согласно заданной структуре.


## II. Функциональность:

1. **Ввод данных:** Пользовательский интерфейс позволяет вводить информацию о сотруднике: фамилия, имя, отчество, СНИЛС, профессия, данные об организации, работодателе, выбранные учебные программы, статус прохождения проверки знаний (сдал/не сдал), номер и дата протокола. Предусмотрена валидация введенных данных на корректность формата.

2. **Сохранение данных в базе данных:** Введенные данные сохраняются в таблицу `users` базы данных SQLite (`data.db`). Если база данных не существует, она создается автоматически. Дата и время добавления записи также записываются в базу.

3. **Очистка полей:** Предусмотрены кнопки для очистки всех полей ввода или только части полей (ФИО, СНИЛС).

4. **Генерация XML:** Приложение позволяет генерировать XML-файлы с данными из базы данных. Можно сгенерировать XML-файл для всех записей или только для записей, соответствующих заданному номеру протокола. Формат XML соответствует определенной структуре.

5. **Просмотр и управление данными (окно "Информация о протоколах"):** Открывает отдельное окно, где отображается информация о сохраненных протоколах в табличном виде. Предоставляет контекстное меню для каждой записи:
    * **Сформировать XML для этого протокола:** Создает XML-файл только для выбранного протокола.
    * **Удалить запись:** Удаляет выбранную запись из базы данных.
    * **Просмотр и изменение записи:** Открывает окно для просмотра и редактирования данных выбранной записи. Изменения сохраняются обратно в базу данных.

## III. Основные функции:

* `validate_snils(snils)`: Проверяет корректность формата СНИЛС.
* `validate_date(date_str)`: Проверяет корректность формата даты.
* `show_message(message, message_type)`: Отображает информационные сообщения пользователю.
* `submit_data(conn)`: Сохраняет данные в базу данных после проверки.
* `clear_all_entries()`: Очищает все поля ввода.
* `clear_partial_entries()`: Очищает поля "Фамилия", "Имя", "Отчество", "СНИЛС".
* `create_xml(conn, target_protocol_number)`: Создает XML-файл.
* `create_database(conn)`: Создает базу данных и таблицу `users`, если они не существуют.
* `show_protocol_info(conn)`: Отображает информацию о протоколах в отдельном окне.
* `generate_xml_for_selected(conn, tree)`: Создает XML-файл для выбранного протокола.
* `delete_selected_entry(conn, tree)`: Удаляет выбранную запись.
* `show_details(conn, tree, selected_item)`: Показывает и позволяет изменить запись.
* `save_changes(item_id)`: Сохраняет изменения в записи.


## IV. Схема базы данных:

Таблица `users`:

| Название поля          | Тип данных | Описание                                       |
|------------------------|------------|------------------------------------------------|
| id                     | INTEGER    | Уникальный идентификатор записи                |
| surname                | TEXT       | Фамилия сотрудника                             |
| name                   | TEXT       | Имя сотрудника                                 |
| patronymic             | TEXT       | Отчество сотрудника                            |
| snils                  | TEXT       | СНИЛС сотрудника                               |
| isForeignSnils         | INTEGER    | 1 - иностранный СНИЛС, 0 - нет                 |
| foreignSnils           | TEXT       | Иностранный СНИЛС                              |
| citizenship            | TEXT       | Гражданство                                    |
| position               | TEXT       | Должность сотрудника                           |
| org_inn                | TEXT       | ИНН организации                                |
| org_title              | TEXT       | Название организации                           |
| employer_org_inn       | TEXT       | ИНН работодателя                               |
| employer_org_title     | TEXT       | Название работодателя                          |
| learn_program_id       | INTEGER    | ID учебной программы                           |
| is_passed              | INTEGER    | 1 - проверка пройдена, 0 - нет                 |
| protocol_number        | TEXT       | Номер протокола                                |
| exam_date              | TEXT       | Дата проверки знаний                           |
| entry_date             | TEXT       | Дата и время добавления записи в базу данных   |


## V. Используемые библиотеки:

* `tkinter`: Для создания графического интерфейса.
* `sqlite3`: Для работы с базой данных SQLite.
* `xml.etree.ElementTree`: Для работы с XML.
* `re`: Для работы с регулярными выражениями (валидация СНИЛС).
* `datetime`: Для работы с датами и временем.


## VI. Инструкция для пользователя:

**Для предварительной настройки (необязательно):**
	1. В строках 471-481 файла main.py c с помощью текстового редактора можно задать ИНН и название аттестующей органиации и организации работодателя работника.
	1.1. Для отображения ковычек в поле ввода формы в коде используются символы  \"

**Для запуска программы:**
	1. Запустить в текущей дерриктории терминал (Клик правой кн. мыши на пустом поле папки и в 
	появившемся контекстном меню выбрать пункт "Открыть в Терминале")
	2. В открывшемся Терминале прописать команду: python main.py
	3. Запустится программа.

**Пояснение к программе:**
	1. Заполнить поля "Имя, Фамилия, Отчество"
	1.1. Если внести в самое нижнее поле для ввода "ФИО (введите через пробел)" фамилию, имя и отчество 
	через пробел в виде "Иванов Иван Иванович" и нажать Enter, то верхние 3 поля ввода Фамилия, Имя, Отчество автоматически
	заполнятся. (Это может быть удобно, если есть такие данные в цифровом виде и есть возможность их целиком копировать.)
	2. Поле "СНИЛС" заполнить цифрами в формате 000-000-000 00
	3. Поле "Профессия" заполнить
	4. Поля "ИНН организации" и "Название организации" предварительно заполненны, но данные можно редактировать.
	5. В окне с перечисленными "Учебными программами" отметить программы, по которым аттестовался 
	работник согласно текущему протоколу (можно отмечать сразу несколько программ). Повторное 
	нажатие на отмеченную учебную программу снимает отметку. Можно использовать вертикальный скролинг
	по списку колесом мыши и малые кнопки "Влево" и "Вправо" для горизонтального скролинга длинных названий
	6. Чек-бокс "Сдал проверку знаний" изначально отмечен, как "Сдано". При необходимости снять отметку.
	7. Внести номер протокола. (Цифры, буквы, символы за исключением символа "/")
	8. Внести дату аттестации в соответсвии с протоколом в форматие дд.мм.гггг
	9. Если аттестованный не является гражданином РФ, то отметить чекбокс "Не гражданин РФ" и заполнить в появившихся
	полях данные об иностранном СНИЛС и гражданстве.
	10. Нажать на кнопку "Отправить в БД" при этом данные об аттестации работника запишутся в файл data.db, который
	лежит в той же дерриктории, что и программа. При отсутствии этого файла он создаётся.
	11. Для удобства внесения следующего аттестованного по тому же протоколу и по тем же программам нажать кнопку
	"Очистить (ФИО)" в правой верхней части интерфейса. После нажатия очистятся только поля ввода "Фамилия", "Имя", "Отчество".
	12. После того, как данные об аттестации всех работников по протоколу отправлены в БД программы, можно создать 
	файл в формате XML, который и будет отправляться в портал Минтруда. Для этого см. п. 13.
	13. В поле ввода "Номер протокола для XML" вносим номер протокола по которому нам надо сформировать 
	файл XML. Затем нажимаем кнопку "Создать XML (для протокола)". После нажатия в текущей дериктории,
	где лежит программа, создается файл XML для указанного протокола с именем, включающим номер протокола и дату создания файла.
	14. Для просмотра уже внесенных записей в базу данных программы нажать кнопку "Информация о протоколах". 
	15. С записями в окне "Информация о протоколах" можно взаимодействовать через контекстное меню, выводимое по нажатию правой кнопки мыши.
	16. Если в поле ввода "ФИО(введите через пробел)" внести целиком ФИО работника и нажать Enter, то автоматически заполнятся верхние поля Фамилия, Имя, Отчество
	(это может быть удобно при работе с подготовленным списком работников в электронном ввиде).
	17. В файле positions.txt лежит редактируемый список должностей. Внося туда изменения можно удобнее и быстрее заполнять поле "Должность" в основной форме.
	При редактировании файла positions.txt важно, чтобы каждая должность начиналась с новой строки (см. существующее форматирование).
	
	

